<% content_for :title, @issue.title %>

<% content_for :sidebar do %>
  <%= render 'sidebar'%>
<% end %>

<% if @conflicting_revisions %>
  <%= render "projects/conflicting_revisions", conflicts: @conflicting_revisions, record: @issue %>
<% end %>

<% content_for :breadcrumbs do %>
<nav>
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><%= link_to 'All issues', project_issues_path(current_project) %></li>
    <li class="breadcrumb-item active"><%= (@issue.title? ? @issue.title : "Issue ##{@issue.id}")%></li>
  </ol>
</nav>
<% end %>

<!-- Main content -->
<ul class="tabs-container nav nav-tabs main-tabs">
  <li class="nav-item">
    <a href="#info-tab" data-toggle="tab" class="nav-link active">
      <%= colored_icon_for_model(@issue, 'fa-bug') %> Information
    </a>
  </li>
  <li class="nav-item"><a href="#evidence-tab" class="nav-link" data-toggle="tab"><i class="fa fa-laptop"></i> Evidence <span class="badge"><%= @issue.evidence.count %></span></a></li>
  <li class="nav-item"><a href="#activity-tab" class="nav-link" data-toggle="tab"><i class="fa fa-refresh"></i> Recent activity</a></li>
  <%= render_view_hooks 'issues/show-tabs' %>
</ul>

<div class="content-container mt-0 pt-4">
  <div class="tab-content mt-0">
    <div class="tab-pane active" id="info-tab" data-behavior="subscription-actions" data-subscribed="<%= !@subscription.nil? %>" >
      <% cache ['issue-information-tab', @issue] do %>
        <div class="note-text-inner">
          <h5 class="mb-4 header-underline">Issue information -
            <span class="actions small">
              <%= link_to edit_project_issue_path(current_project, @issue),
                    class: 'action-link' do %>
                <i class="fa fa-pencil"></i> Edit
              <% end %>
              <%= link_to [current_project, @issue],
                    class: 'action-link text-error',
                    data: { confirm: "Are you sure?\n\nProceeding will delete this issue and any associated evidence." },
                    method: :delete do %>
                <i class="fa fa-trash"></i> Delete
              <% end %> -
              <%= render 'subscriptions/actions', subscribable: @issue %> -
              <%= render partial: 'send_to_menu' %>
              <%= tag_and_name_for(@issue) %>
            </span>
            <small class="pull-right small">Author: <%= @issue.author %></small>
          </h5>
          <div class="content-textile">
            <%= markup(@issue.text) %>
          </div>
        </div>
      <% end %>

      <%= render 'comments/feed' %>
      <%= render 'subscriptions/feed', subscribable: @issue %>
    </div>


    <div class="tab-pane" id="evidence-tab">
      <%= render partial: 'evidence' %>
    </div>

    <% cache ['issue-activity-tab', @issue, @activities] do %>
      <div class="tab-pane" id="activity-tab">
        <%= render partial: 'activity' %>
      </div>
    <% end %>

    <%= render_view_hooks 'issues/show-content' %>
  </div>
</div>