<% partial = escape_javascript(
  render partial: 'notifications',
  locals: { notifications: @notifications,  unread_count: @unread_count}
) %>
$('[data-id="js-notification-container"]').html("<%= partial %>");

// We attach the click event here as the read links are generated by this script
$readAll = $('[data-id="js-read-all"]');
$readAll.click( function(e){
  e.stopPropagation();

  $.ajax({
    url: $readAll.data('url'),
    dataType: 'json',
    method: 'POST',
    success: function(data) {
      $container  = $('[data-id="js-notification-container"]')
      $container.find('li.notification').removeClass('unread');
    }
  });
});

$readBtn = $('[data-id="js-read-notification"]');
$readBtn.each( function(index){
  $(this).click( function(e){
    e.stopPropagation();

    $.ajax({
      url: $(this).data('url'),
      dataType: 'json',
      method: 'POST',
      success: function(data) {
        console.log(data);
        $notification = $('[data-notification-id="' + data.id + '"]');
        console.log($notification);
        $notification.removeClass('unread');
      }
    });
  });
});
