<% partial = escape_javascript(
  render partial: 'dropdown',
  locals: { notifications: @notifications,  unread_count: @unread_count}
) %>
$('[data-behavior~=notifications-dropdown] + div').html("<%= partial %>");

// We attach the click event here as the read links are generated by this script
$readAll = $('[data-behavior~=read-all]');
$readAll.click( function(e){
  e.stopPropagation();

  $.ajax({
    url: $readAll.data('url'),
    dataType: 'json',
    method: 'POST',
    success: function(data) {
      $container = $('[data-behavior~=notifications-dropdown] + div')
      $container.find('li.notification').removeClass('unread');
      $('[data-behavior~=notifications-dot]').addClass('hidden');
    }
  });
});

$readBtn = $('[data-behavior~=read-notification]');
$readBtn.each( function(index){
  $(this).click( function(e){
    e.stopPropagation();

    $.ajax({
      url: $(this).data('url'),
      dataType: 'json',
      method: 'POST',
      success: function(data) {
        $notification = $('[data-notification-id="' + data.id + '"]');
        $notification.removeClass('unread');
        if (!data.has_unread) $('[data-behavior~=notifications-dot]').addClass('hidden');
      }
    });
  });
});
